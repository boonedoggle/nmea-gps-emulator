# NMEA-GPS Emulator

Based on [https://github.com/luk-kop/nmea-gps-emulator](https://github.com/luk-kop/nmea-gps-emulator)
with the following changes:
* Remove interactive mode
* Added ability to read settings/coordinates from a JSON file
* Changed longitude/latitude to be decimal degrees instead of degrees + decimal minutes
* Removed TCP stream and serial features. Only supports TCP server mode.
* Added `setup.py`
* Made it run as a system service
* Made compatible with Python 3.6.9+

[![Python 3.6.](https://img.shields.io/badge/python-3.6.9-blue.svg)](https://www.python.org/downloads/release/python-385/)
[![MIT license](https://img.shields.io/badge/License-MIT-blue.svg)](https://lbesson.mit-license.org/)

The **NMEA-GPS Emulator** is a simple script that emulates a GPS receiver (simulates
unit's movement). Data generated by the script are sent to clients in **NMEA 0183** format. 
This script can be useful for testing applications or systems that require some unit's GPS
position data.

The **NMEA-GPS Emulator** script is used as a NMEA TCP Server (the server waits for client
connections, then sends TCP packets to the connected clients)
***
## Features
- The script allows the user to enter the following data into a settings file:
  - Location
  - Velocity
  - IP address, port
  - Number of allowed connections
  - IP address & port pair or serial port name
- Generated NMEA sentences are resent to the selected clients periodically (every second). 
Each time a data with NMEA sentences is sent, the position of the unit is updated based on 
its velocity vector.

***
## Getting Started
Below instructions will get you a copy of the project up and running on your local machine.

1. Install the requirements:
   * Python 3.6.9+
   * Pip 10.0.1
   * GPSD

2. Clone the repository
```bash
cd /opt
sudo git clone https://github.com/boonedoggle/nmea-gps-emulator
```

3. Install the package
```bash
cd nmea-gps-emulator
sudo -H pip3 install -e .
```
The package is installed at this point, but not running.

## Running the emulation
You can run the software package directly or as a system service

### System Service
* Start the service:
```bash
  sudo systemctl start nmea_gps_emulator
```
* Stop the service:
```bash
  sudo systemctl stop nmea_gps_emulator
```
* Enable the service to start at boot
```bash
  sudo systemctl enable nmea_gps_emulator
```

3. Start the service
```bash
sudo systemctl start gpsd
```

## Modify the GPS coordinates
Update the settings file:
```bash
sudo nano /opt/nmea-gps-emulator/settings/settings.json
sudo systemctl restart nmea_gps_emulator
```

* Install GPSD

* Edit the GPSD config file to add the NMEA emulator (on Ubuntu):
```bash
$ sudo nano /etc/default/gpsd
```
Add the following as a device:
```bash
DEVICES="tcp://localhost:10110"
```

* Restart GPSD
```bash
$ sudo systemctl restart gpsd
```

* Run `gpsmon`
```text
$ gpsmon

tcp://localhost:2947          NMEA0183>
┌──────────────────────────────────────────────────────────────────────────────┐
│Time: 2023-04-30T00:21:53.000Z Lat:  39 56' 59.04287" Non:  75 09' 55.04005" E│
└───────────────────────────────── Cooked TPV ─────────────────────────────────┘
│ GPGGA GPGSA GPGSV GPGLL GPRMC GPHDT GPVTG GPZDA                              │
┌──────────────────┐┌────────────────────────────┐┌────────────────────────────┐
│Ch PRN  Az El S/N ││Time:      002153.000       ││Time:      002153.00        │
│ 0   2  81 29  32 ││Latitude:   3956.990479 N   ││Latitude:  3956.990479      │
│ 1   1  26 85  83 ││Longitude: 07509.923343 E   ││Longitude: 07509.923343     │
│ 2  25 116 50  12 ││Speed:     0.000            ││Altitude:  15.2             │
│ 3  30  40 13  80 ││Course:    0.0              ││Quality:   1   Sats: 07     │
│ 4   7 177 20  93 ││Status:    A       FAA: A   ││HDOP:      0.92             │
│ 5  28 274 30   6 ││MagVar:                     ││Geoid:     32.5             │
│ 6   6 222 17  92 │└─────────── RMC ────────────┘└─────────── GGA ────────────┘
│ 7  20 225 86  27 │┌────────────────────────────┐┌────────────────────────────┐
│ 8  16 214 86  26 ││Mode: A3 Sats: 7 28 6 20 10 ││UTC:           RMS:         │
│ 9  10 272 33  36 ││DOP: H=0.92  V=1.25  P=1.56 ││MAJ:           MIN:         │
│10  19   2 17  21 ││TOFF:  0.360796133          ││ORI:           LAT:         │
│11   4 315 10  85 ││PPS:                        ││LON:           ALT:         │
└────── GSV ───────┘└──────── GSA + PPS ─────────┘└─────────── GST ────────────┘
(76) $GPGGA,002151.00,3956.990479,N,07509.923343,E,1,07,0.92,15.2,M,32.5,M,,*61
(56) $GPGSA,A,3,28,04,06,19,10,20,07,,,,,,1.56,0.92,1.25*09
(70) $GPGSV,4,1,15,02,29,081,32,01,85,026,83,25,50,116,12,30,13,040,80*70
(70) $GPGSV,4,2,15,07,20,177,93,28,30,274,06,06,17,222,92,20,86,225,27*7E
(70) $GPGSV,4,3,15,16,86,214,26,10,33,272,36,19,17,002,21,04,10,315,85*73
(57) $GPGSV,4,4,15,05,69,012,89,18,70,236,69,21,65,215,69*4A
(55) $GPGLL,3956.990479,N,07509.923343,E,002151.000,A,A*5A
(74) $GPRMC,002151.000,A,3956.990479,N,07509.923343,E,0.000,0.0,300423,,,A*6B
(17) $GPHDT,0.0,T*35
```

## Troubleshooting
* Pip too old
  * `sudo pip3 install --upgrade pip`
